# 要件ドキュメント

## はじめに

このドキュメントでは、MCPサーバーの設定ファイルをAnsibleを使用して配置するための要件を定義します。Model Context Protocol (MCP) サーバーは、AIモデルとの対話を強化するためのサーバーであり、その設定ファイルをmacOSシステムに効率的に配置・管理する必要があります。このAnsibleロールはmacOSシステムのみをターゲットとしています。

設定ファイルは、Kiro、Amazon Q Developer、akiなどの複数のMCPサーバー対応ツールから共通して参照できるように、標準的な場所（$HOME/.config/mcp.json）に配置する必要があります。これにより、一元管理された設定を複数のツールで共有することが可能になります。

また、MCPサーバーの実行に必要な一般的なコマンドやツール（uvx、uv、Pythonなど）もインストールする必要があります。これにより、MCPサーバーが正常に動作するための環境を整えることができます。

## 要件

### 要件 1: MCPサーバー設定ファイルの配置

**ユーザーストーリー:** macOSユーザーとして、MCPサーバーの設定ファイルをmacOSシステムに一貫して配置したいので、Kiro、Amazon Q Developer、akiなど複数のMCPサーバー対応ツールで共通の設定を使用できます。

#### 受け入れ基準

1. WHEN Ansibleプレイブックが実行される THEN システムはMCPサーバーの設定ファイルを共通参照ファイル（$HOME/.config/mcp.json）に配置する
2. WHEN 設定ファイルが既に存在する場合 THEN システムは設定ファイルを上書きする
3. WHEN 設定ファイルのディレクトリ（$HOME/.config/）が存在しない場合 THEN システムは必要なディレクトリ構造を作成する
4. WHEN 設定ファイルが配置される THEN システムは適切なファイル権限とオーナーシップを設定する（macOSユーザー所有）
5. IF 特定のツールが異なるパスで設定ファイルを探す場合 THEN システムは必要に応じてシンボリックリンクを作成する

### 要件 2: MCPサーバー設定の変数化

**ユーザーストーリー:** macOSユーザーとして、個人環境と業務環境など異なるmacOS環境ごとにMCPサーバー設定を変数として定義したいので、複数のMCPサーバー対応ツール（Kiro、Amazon Q Developer、akiなど）に対して一貫した設定を柔軟にカスタマイズできます。

#### 受け入れ基準

1. WHEN Ansibleプレイブックが実行される THEN システムは変数から設定ファイルを生成する
2. WHEN 環境固有の変数が定義されている THEN システムはそれらの変数を使用して設定ファイルをカスタマイズする
3. WHEN 変数が定義されていない場合 THEN システムはデフォルト値を使用する
4. WHEN 機密情報が必要な場合 THEN システムはAnsible Vaultから安全に取得する

### 要件 3: MCPサーバー設定の検証

**ユーザーストーリー:** macOSユーザーとして、配置されたMCPサーバー設定が有効であることを確認したいので、複数のMCPサーバー対応ツールで使用する際の設定エラーによる問題を事前に防止できます。

#### 受け入れ基準

1. WHEN 設定ファイルが配置される THEN システムは設定ファイルの構文が有効であることを検証する
2. WHEN 設定ファイルが無効な場合 THEN システムはエラーを報告し、プレイブックの実行を中止する
3. WHEN 設定ファイルが変更された場合 THEN システムは関連サービスの再起動が必要かどうかを判断する

### 要件 4: MCPサーバー必須コマンドのインストール

**ユーザーストーリー:** macOSユーザーとして、MCPサーバーの実行に必要なコマンドやツールを自動的にインストールしたいので、MCPサーバーを簡単に利用開始できます。

#### 受け入れ基準

1. WHEN Ansibleプレイブックが実行される THEN システムはMCPサーバーの実行に必要なコマンド（uvx、uv）をインストールする
2. WHEN 必要なコマンドが既にインストールされている場合 THEN システムは最新バージョンに更新する
3. WHEN 依存関係（Python）が不足している場合 THEN システムは必要な依存関係をインストールする
4. WHEN コマンドのインストールが完了する THEN システムはインストールが成功したことを確認する

