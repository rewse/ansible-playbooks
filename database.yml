---
- hosts: centos
  become: yes
  remote_user: centos
  vars_files:
    - gitignored_vars.yml
  tasks:
    - name: install mysql57-community-release-el7-9
      yum:
        name: http://repo.mysql.com//mysql57-community-release-el7-9.noarch.rpm
        state: installed
      tags: [mysql, package]

    - name: add priority into /etc/yum.repos.d/mysql-community.repo
      ini_file:
        dest: /etc/yum.repos.d/mysql-community.repo
        section: "{{item}}"
        option: priority
        value: 30
        no_extra_spaces: True
      with_items:
        - mysql-connectors-community
        - mysql-tools-community
        - mysql57-community
      tags: [mysql, package]

    - name: install mysql client
      yum:
        name: "{{item}}"
        state: installed
      with_items:
        - mysql-community-client
        - mysql-connector-java
      tags: [client, mysql]

      # Download the files before the following task
      # from <http://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html>
    - name: copy oracle-12.1 client
      copy:
        src: ~/Downloads/{{item}}
        dest: /usr/local/src
      with_items:
        - oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm
        - oracle-instantclient12.1-jdbc-12.1.0.2.0-1.x86_64.rpm
        - oracle-instantclient12.1-sqlplus-12.1.0.2.0-1.x86_64.rpm
      tags: [client, oracle]

    - name: install oracle-12.1 client
      yum:
        name: "{{item}}"
        state: installed
      with_items:
        - rlwrap
        - /usr/local/src/oracle-instantclient12.1-basic-12.1.0.2.0-1.x86_64.rpm
        - /usr/local/src/oracle-instantclient12.1-jdbc-12.1.0.2.0-1.x86_64.rpm
        - /usr/local/src/oracle-instantclient12.1-sqlplus-12.1.0.2.0-1.x86_64.rpm
      tags: [client, oracle]

    - name: clone orascript.git
      git:
        repo: git@github.com:rewse/orascript.git
        dest: /srv/git/orascript
        accept_hostkey: yes
        key_file: /home/{{admin_username}}/.ssh/id_rsa
      tags: [client, oracle]

    - name: change mode of git/orascript
      file:
        path: /srv/git/orascript
        owner: "{{admin_username}}"
        group: "{{admin_username}}"
        recurse: yes
      tags: [client, oracle]

    - name: copy orarc
      copy:
        src: /srv/git/orascript/orarc
        dest: /home/{{admin_username}}/.orarc
        remote_src: True
      tags: [client, oracle]

    - name: create symlink for orascript/common
      file:
        src: /srv/git/orascript/common
        dest: /home/{{admin_username}}/oracle
        state: link
      tags: [client, oracle]

    - name: install postgresql client
      yum:
        name: "{{item}}"
        state: installed
      with_items:
        - postgresql
        - postgresql-jdbc
      tags: [client, postgresql]

    - name: install redshift-1.2.1 client
      get_url:
        url: https://s3.amazonaws.com/redshift-downloads/drivers/RedshiftJDBC42-1.2.1.1001.jar
        dest: /usr/share/java
      tags: [client, redshift]

    - name: create symlink RedShiftJDBC.jar
      file:
        src: RedshiftJDBC42-1.2.1.1001.jar
        dest: /usr/share/java/RedshiftJDBC.jar
        state: link
      tags: [client, redshift]

    - name: create symlinks from RedshiftJDBC.jar
      file:
        src: RedshiftJDBC.jar
        dest: /usr/share/java/{{item}}
        state: link
      with_items:
        - RedshiftJDBC42.jar
        - RedshiftJDBC41.jar
        - RedshiftJDBC4.jar
      tags: [client, redshift]
