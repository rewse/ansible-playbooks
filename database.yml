---
- hosts: centos
  become: yes
  remote_user: centos
  tasks:
    - name: install mysql57-community-release-el7-9
      yum:
        name: http://repo.mysql.com//mysql57-community-release-el7-9.noarch.rpm
        state: installed
      tags: [mysql, package]

    - name: add priority into /etc/yum.repos.d/mysql-community.repo
      ini_file:
        dest: /etc/yum.repos.d/mysql-community.repo
        section: "{{item}}"
        option: priority
        value: 30
        no_extra_spaces: True
      with_items:
        - mysql-connectors-community
        - mysql-tools-community
        - mysql57-community
      tags: [mysql, package]

    - name: install mysql client
      yum:
        name: "{{item}}"
        state: installed
      with_items:
        - mysql-community-client
        - mysql-connector-java
      tags: [client, mysql]

    - name: install centos-release-scl
      yum:
        name: centos-release-scl
        state: installed
      tags: [package, postgresql]

    - name: add priority into /etc/yum.repos.d/CentOS-SCLo-scl.repo
      ini_file:
        dest: /etc/yum.repos.d/CentOS-SCLo-scl.repo
        section: centos-sclo-sclo
        option: priority
        value: 30
        no_extra_spaces: True
      tags: [package, postgresql]

    - name: add priority into /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo
      ini_file:
        dest: /etc/yum.repos.d/CentOS-SCLo-scl-rh.repo
        section: centos-sclo-rh
        option: priority
        value: 30
        no_extra_spaces: True
      tags: [package, postgresql]

    - name: install postgresql-9.5 client
      yum:
        name: "{{item}}"
        state: installed
      with_items:
        - postgresql-jdbc
        - rh-postgresql95-postgresql
      tags: [client, postgresql]

    - name: install redshift-1.2.1 client
      get_url:
        url: https://s3.amazonaws.com/redshift-downloads/drivers/RedshiftJDBC42-1.2.1.1001.jar
        dest: /usr/share/java
      tags: [client, redshift]

    - name: create symlink RedShiftJDBC.jar
      file:
        src: RedshiftJDBC42-1.2.1.1001.jar
        dest: /usr/share/java/RedshiftJDBC.jar
        state: link
      tags: [client, redshift]

    - name: create symlinks from RedshiftJDBC.jar
      file:
        src: RedshiftJDBC.jar
        dest: /usr/share/java/{{item}}
        state: link
      with_items:
        - RedshiftJDBC42.jar
        - RedshiftJDBC41.jar
        - RedshiftJDBC4.jar
      tags: [client, redshift]
