settings {
  insist = true,
  logfile = "/var/log/lsyncd/lsyncd.log",
  statusFile = "/var/log/lsyncd/lsyncd.status",
  pidfile = "/var/run/lsyncd.pid"
}

sync {
  default.rsync,
  source="/srv/www",
{% if ansible_hostname == "srv1" %}
  target="srv2.rewse.jp::www",
{% elif ansible_hostname == "srv2" %}
  target="srv1.rewse.jp::www",
{% endif %}
  init = false
}

sync {
  default.rsync,
  source="/srv/mailman/etc",
{% if ansible_hostname == "charlie" %}
  target="foxtrot.rewse.jp::mailman-etc",
{% elif ansible_hostname == "foxtrot" %}
  target="charlie.rewse.jp::mailman-etc",
{% endif %}
  init = false
}

sync {
  default.rsync,
  source="/srv/mailman/var",
{% if ansible_hostname == "charlie" %}
  target="foxtrot.rewse.jp::mailman-var",
{% elif ansible_hostname == "foxtrot" %}
  target="charlie.rewse.jp::mailman-var",
{% endif %}
  init = false
}

{% for user in users %}
sync {
  default.rsync,
  source="/srv/mail/{{user}}",
{% if ansible_hostname == "charlie" %}
  target="foxtrot.rewse.jp::mail-{{user}}",
{% elif ansible_hostname == "foxtrot" %}
  target="charlie.rewse.jp::mail-{{user}}",
{% endif %}
  init = false
}

{% endfor %}
