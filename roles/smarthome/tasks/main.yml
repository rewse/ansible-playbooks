---
- name: install additional packages
  apt:
    name:
      - libbluetooth3-dev
      - libboost-python-dev
      - libboost-thread-dev
      - libglib2.0-0
      - python3-pexpect
    state: present
  tags: [smarthome, package]

- name: install packages with pip3
  pip:
    name:
      - bluepy
      - gattlib
      - pybluez
    executable: pip3
  tags: [smarthome, package, pip]

- name: clone python-host.git
  git:
    repo: https://github.com/OpenWonderLabs/python-host.git
    dest: /srv/git/switchbot
    force: yes
  tags: [smarthome, switchbot]

- name: add a shebang to switchbot_py3.py
  lineinfile:
    dest: /srv/git/switchbot/switchbot_py3.py
    insertbefore: BOF
    line: '#!/usr/bin/env python3'
    state: present
  tags: [smarthome, switchbot]

- name: copy switchbot_py3.py files to /usr/local/sbin
  copy:
    src: /srv/git/switchbot/switchbot_py3.py
    dest: /usr/local/sbin/switchbot
    mode: '0755'
    remote_src: yes
  tags: [smarthome, switchbot]

- name: copy switchbot_meter_py3.py files to /usr/local/sbin
  copy:
    src: /srv/git/switchbot/switchbot_meter_py3.py
    dest: /usr/local/sbin/switchbot_meter
    mode: '0755'
    remote_src: yes
  tags: [smarthome, switchbot]