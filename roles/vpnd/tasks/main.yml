- name: Install additional packages
  ansible.builtin.apt:
    name:
      - qrencode
      - wireguard
  tags: [vpnd]

- name: Copy a privatekey
  ansible.builtin.template:
    src: privatekey.j2
    dest: /etc/wireguard/privatekey
  notify: Restart vpnd
  tags: [vpnd]

- name: Copy a publickey
  ansible.builtin.template:
    src: publickey.j2
    dest: /etc/wireguard/publickey
  notify: Restart vpnd
  tags: [vpnd]

- name: Copy wg0.conf
  ansible.builtin.template:
    src: wg0.conf.j2
    dest: /etc/wireguard/wg0.conf
  notify: Restart vpnd
  tags: [vpnd]

- name: Enable IPv4 Forwarding
  ansible.posix.sysctl:
    name: net.ipv4.ip_forward
    value: "1"
  tags: [vpnd]

- name: Enable IPv6 Forwarding
  ansible.posix.sysctl:
    name: net.ipv6.conf.all.forwarding
    value: "1"
  tags: [vpnd]

- name: Enable wg-quick@wg0
  ansible.builtin.systemd:
    name: wg-quick@wg0
    enabled: yes
  tags: [vpnd]
