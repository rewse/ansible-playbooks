- id: automation.alarm_bio_sim_1_is_not_docomo
  alias: "ALARM: bio SIM 1 is not Docomo"
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.living_room_motion
      to: "on"
    - platform: state
      entity_id: binary_sensor.study_motion
      to: "on"
    - platform: state
      entity_id: binary_sensor.bathroom_motion
      to: "on"
  condition:
    - condition: state
      entity_id: device_tracker.ping_bio
      state: home
    - condition: not
      conditions:
        - condition: state
          entity_id: sensor.bio_sim_1
          state: ドコモ
  action:
    - service: notify.tats_devices
      data:
        title: "⚠️ ALARM"
        message: "bio SIM 1 is not Docomo. Current: {{ states('sensor.bio_sim_1') }}"
        data:
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
- id: automation.alarm_kijishiro_ssid_is_victor
  alias: "ALARM: kijishiro SSID is victor"
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.living_room_motion
      to: "on"
    - platform: state
      entity_id: binary_sensor.study_motion
      to: "on"
    - platform: state
      entity_id: binary_sensor.bathroom_motion
      to: "on"
  condition:
    - condition: state
      entity_id: sensor.kijishiro_ssid
      state: victor
  action:
    - service: notify.tats_devices
      data:
        title: "⚠️ ALARM"
        message: "kijishiro SSID is victor"
        data:
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
- id: automation.turn_off_surveillance
  alias: Turn off Surveillance
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.living_room_motion
      to: "on"
    - platform: state
      entity_id: binary_sensor.study_motion
      to: "on"
    - platform: state
      entity_id: binary_sensor.bathroom_motion
      to: "on"
  condition:
    - condition: state
      entity_id: alarm_control_panel.surveillance
      state: armed_away
      for:
        minutes: 20
    - condition: or
      conditions:
        - condition: state
          entity_id: person.shibata_tats
          state: home
        - condition: state
          entity_id: person.shibata_akiko
          state: home
  action:
    - service: alarm_control_panel.alarm_disarm
      target:
        entity_id: alarm_control_panel.surveillance
    - service: notify.all_devices
      data:
        message: Turned off surveillance
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
- id: automation.turn_on_surveillance_when_ios_action_fires
  alias: Turn on surveillance when iOS Action Fires
  trigger:
    - platform: event
      event_type: ios.action_fired
      event_data:
        actionName: turn_on_surveillance
  action:
    - service: alarm_control_panel.alarm_arm_away
      target:
        entity_id: alarm_control_panel.surveillance
    - service: notify.all_devices
      data:
        message: Now Arming Away
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
- id: automation.turn_on_surveillance_when_nobody_is_in_home
  alias: Turn on surveillance when Nobody is in Home
  trigger:
    - platform: time_pattern
      minutes: "/5"
      seconds: 46
  condition:
    - condition: state
      entity_id: alarm_control_panel.surveillance
      state: disarmed
    - condition: state
      entity_id: person.shibata_tats
      state: not_home
      for:
        minutes: 10
    - condition: state
      entity_id: person.shibata_akiko
      state: not_home
      for:
        minutes: 10
  action:
    - service: alarm_control_panel.alarm_arm_away
      target:
        entity_id: alarm_control_panel.surveillance
    - service: notify.all_devices
      data:
        message: Turn on surveillance because nobody is in home
        data:
          push:
            interruption-level: time-sensitive
