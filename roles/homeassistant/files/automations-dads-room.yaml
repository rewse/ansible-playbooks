# Climates

- id: automation.alarm_dads_room_humidity_difference_is_too_large
  alias: "ALARM: Dad’s Room Humidity Difference is Too Large"
  mode: single
  trigger:
    - platform: state
      entity_id: sensor.dads_room_switchbot_meter_humidity
  condition:
    - condition: numeric_state
      entity_id: sensor.average_of_dads_room_humidity_difference
      above: 10
    - condition: numeric_state
      entity_id: sensor.dads_room_humidity_difference
      above: 10
  action:
    - service: notify.tats_devices
      data:
        title: "⚠️ ALARM"
        message: "Dad’s Room Humidity Difference is Too Large. Current: {{ states('sensor.dads_room_humidity') }}% / {{ states('sensor.dads_room_switchbot_meter_humidity') }}%"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 8
  trace:
    stored_traces: 100
- id: automation.alarm_dads_room_temperature_difference_is_too_large
  alias: "ALARM: Dad’s Room Temperature Difference is Too Large"
  mode: single
  trigger:
    - platform: state
      entity_id: sensor.dads_room_switchbot_meter_temperature
  condition:
    - condition: numeric_state
      entity_id: sensor.average_of_dads_room_temperature_difference
      above: 1
    - condition: numeric_state
      entity_id: sensor.dads_room_temperature_difference
      above: 1
  action:
    - service: notify.tats_devices
      data:
        title: "⚠️ ALARM"
        message: "Dad’s Room Temperature Difference is Too Large. Current: {{ states('sensor.dads_room_temperature') }}°C / {{ states('sensor.dads_room_switchbot_meter_temperature') }}°C"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 8
  trace:
    stored_traces: 100
- id: automation.turn_off_dads_room_floor_heating
  alias: Turn off Dad’s Room Floor Heating
  trigger:
    - platform: state
      entity_id: binary_sensor.dads_room_presence
      to: "off"
      for:
        minutes: 20
    - platform: time_pattern
      minutes: "/5"
      seconds: 39
  condition:
    - condition: state
      entity_id: binary_sensor.dads_room_presence
      state: "off"
      for:
        minutes: 20
    - condition: state
      entity_id: switch.dads_room_floor_heating_plug_socket_1
      state: "on"
  action:
    - service: switch.turn_off
      entity_id: switch.dads_room_floor_heating_plug_socket_1
    - service: notify.tats_devices
      data:
        message: "Turned off Dad’s Room Floor Heating"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
  trace:
    stored_traces: 100
- id: automation.turn_off_dads_room_humidifier
  alias: Turn off Dad’s Room Humidifier
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.dads_room_presence
      to: "on"
    - platform: time_pattern
      minutes: "/5"
      seconds: 28
  condition:
    - condition: numeric_state
      entity_id: sensor.dads_room_humidity
      above: input_number.dads_room_humidifier_turned_off_threshold
    - condition: state
      entity_id: switch.dads_room_humidifier
      state: "on"
  action:
    - service: switch.turn_off
      entity_id: switch.dads_room_humidifier
    - service: notify.tats_devices
      data:
        message: "Turned off Dad’s Room Humidifier. Current: {{ states('sensor.dads_room_humidity') }}%"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
  trace:
    stored_traces: 100
- id: automation.turn_off_dads_room_humidifier_due_to_nobody
  alias: Turn off Dad’s Room Humidifier Due to Nobody
  trigger:
    - platform: time_pattern
      minutes: "/5"
      seconds: 18
  condition:
    - condition: state
      entity_id: binary_sensor.dads_room_presence
      state: "off"
      for:
        minutes: 30
    - condition: time
      after: "12:00:00"
      before: "20:00:00"
    - condition: state
      entity_id: switch.dads_room_humidifier
      state: "on"
  action:
    - service: switch.turn_off
      entity_id: switch.dads_room_humidifier_switch
    - service: notify.tats_devices
      data:
        message: "Turned off Dad’s Room Humidifier Due to Nobody. Current: {{ states('sensor.dads_room_humidity') }}%"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
  trace:
    stored_traces: 100
- id: automation.turn_on_dads_room_humidifier
  alias: Turn on Dad’s Room Humidifier
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.dads_room_presence
      to: "on"
      for:
        minutes: 3
    - platform: time_pattern
      minutes: "/5"
      seconds: 41
  condition:
    - condition: numeric_state
      entity_id: sensor.dads_room_humidity
      below: input_number.dads_room_humidifier_turned_on_threshold
    - condition: state
      entity_id: switch.dads_room_humidifier
      state: "off"
      for:
        minutes: 30
    - condition: state
      entity_id: binary_sensor.dads_room_presence
      state: "on"
      for:
        minutes: 3
  action:
    - service: switch.turn_on
      entity_id: switch.dads_room_humidifier
    - service: notify.tats_devices
      data:
        message: "Turned on Dad’s Room Humidifier. Current: {{ states('sensor.dads_room_humidity') }}%"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
  trace:
    stored_traces: 100

# Others

- id: automation.alarm_dads_room_co2_is_too_high
  alias: "ALARM: Dad’s Room CO2 is Too High"
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.dads_room_presence
      to: "on"
    - platform: time_pattern
      minutes: "/5"
      seconds: 55
  condition:
    - condition: numeric_state
      entity_id: sensor.dads_room_co2
      above: 1000
  action:
    - service: notify.tats_devices
      data:
        title: "⚠️ ALARM"
        message: "Dad’s Room CO2 is too high. Current: {{ states('sensor.dads_room_co2') }}ppm"
        data:
          url: /lovelace/home
          push:
            interruption-level: time-sensitive
    - delay:
        hours: 1
  trace:
    stored_traces: 100
