- id: automation.select_time_mode
  alias: Select Time Mode
  triggers:
    - trigger: time_pattern
      minutes: "/5"
      seconds: 18
    - trigger: homeassistant
      event: start
  actions:
    - choose:
        - conditions:
            - condition: sun
              after: sunrise
              after_offset: "1:15:00"
              before: sunset
            - condition: numeric_state
              entity_id: sensor.living_room_light_level
              above: input_number.time_mode_twilight_light_level
            - not:
                - condition: state
                  entity_id: input_select.time_mode
                  state: Twilight
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Daytime
        - conditions:
            - condition: sun
              after: sunrise
              after_offset: "1:15:00"
              before: sunset
            - condition: numeric_state
              entity_id: sensor.living_room_light_level
              below: input_number.time_mode_twilight_light_level
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Twilight
        - conditions:
            - condition: sun
              after: sunset
            - condition: time
              before: input_datetime.time_mode_late_night
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Night
        - conditions:
            - condition: time
              after: input_datetime.time_mode_late_night
              before: input_datetime.time_mode_midnight
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Late Night
        - conditions:
            - or:
                - condition: time
                  after: input_datetime.time_mode_midnight
                - condition: sun
                  before: sunrise
                  before_offset: "1:15:00"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Midnight
  trace:
    stored_traces: 100
