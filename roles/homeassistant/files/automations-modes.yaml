- id: automation.select_time_mode
  alias: Select Time Mode
  triggers:
    - trigger: time_pattern
      minutes: "/5"
      seconds: 18
    - trigger: homeassistant
      event: start
  actions:
    - choose:
        - conditions:
            - condition: sun
              after: sunrise
              after_offset: "00:30:00"
              before: sunset
            - condition: numeric_state
              entity_id: sensor.living_room_light_level
              above: 21
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Daytime
        - conditions:
            - condition: sun
              after: sunrise
              after_offset: "00:30:00"
              before: sunset
            - condition: numeric_state
              entity_id: sensor.living_room_light_level
              below: 21
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Twilight
        - conditions:
            - condition: sun
              after: sunset
            - condition: time
              before: "22:30:00"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Night
        - conditions:
            - condition: time
              after: "22:30:00"
              before: "23:30:00"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Late Night
        - conditions:
            - or:
                - condition: time
                  after: "23:30:00"
                - condition: sun
                  before: sunrise
                  before_offset: "00:30:00"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.time_mode
              data:
                option: Midnight
  trace:
    stored_traces: 100
