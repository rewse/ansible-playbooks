- id: automation.select_dads_room_climate_mode
  alias: "Select Dad’s Room Climate Mode"
  triggers:
    - trigger: state
      entity_id:
        - input_select.season_mode
        - input_select.time_mode
    - trigger: state
      entity_id: input_boolean.dads_room_presence_mode
      to: "on"
    - trigger: state
      entity_id: input_boolean.dads_room_presence_mode
      to: "off"
      for:
        minutes: "{{ states('input_number.dads_room_climate_auto_off_minutes') }}"
    - trigger: homeassistant
      event: start
  actions:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.dads_room_presence_mode
              state: "on"
            - condition: state
              entity_id: input_select.season_mode
              state: "Summer"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.dads_room_climate_mode
              data:
                option: "Present Summer"
        - conditions:
            - condition: state
              entity_id: input_boolean.dads_room_presence_mode
              state: "on"
            - condition: state
              entity_id: input_select.season_mode
              state: "Winter"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.dads_room_climate_mode
              data:
                option: "Present Winter"
        - conditions:
            - condition: state
              entity_id: input_boolean.dads_room_presence_mode
              state: "on"
            - condition: state
              entity_id: input_select.season_mode
              state: "Summer"
            - condition: state
              entity_id: input_select.time_mode
              state: 
                - "Midnight"
                - "Dark"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.dads_room_climate_mode
              data:
                option: "Present Summer Midnight"
        - conditions:
            - condition: state
              entity_id: input_boolean.dads_room_presence_mode
              state: "on"
            - condition: state
              entity_id: input_select.season_mode
              state: "Winter"
            - condition: state
              entity_id: input_select.time_mode
              state: 
                - "Midnight"
                - "Dark"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.dads_room_climate_mode
              data:
                option: "Present Winter Midnight"
        - conditions:
            - condition: state
              entity_id: input_boolean.dads_room_presence_mode
              state: "off"
              for:
                minutes: "{{ states('input_number.dads_room_climate_auto_off_minutes') }}"
            - condition: state
              entity_id: input_select.season_mode
              state: "Summer"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.dads_room_climate_mode
              data:
                option: "Absent Summer"
        - conditions:
            - condition: state
              entity_id: input_boolean.dads_room_presence_mode
              state: "off"
              for:
                minutes: "{{ states('input_number.dads_room_climate_auto_off_minutes') }}"
            - condition: state
              entity_id: input_select.season_mode
              state: "Winter"
          sequence:
            - action: input_select.select_option
              target: 
                entity_id: input_select.dads_room_climate_mode
              data:
                option: "Absent Winter"
  trace:
    stored_traces: 100
- id: automation.select_dads_room_humiture_target
  alias: "Select Dad’s Room Humiture Target"
  triggers:
    - trigger: state
      entity_id: input_select.dads_room_climate_mode
    - trigger: state
      entity_id:
        - input_number.dads_room_temp_max_diff
        - input_number.dads_room_humidity_max_diff
        - input_number.dads_room_temp_min_diff
        - input_number.dads_room_humidity_min_diff
        - input_number.dads_room_temp_target
        - input_number.dads_room_humidity_target
      for:
        hours: 1
    - trigger: homeassistant
      event: start
  actions:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_select.dads_room_climate_mode
              state: "Present Summer"
          sequence:
            repeat:
              for_each:
                - src: input_number.dads_room_temp_max_diff_present_summer
                  dest: input_number.dads_room_temp_max_diff
                - src: input_number.dads_room_humidity_max_diff_present_summer
                  dest: input_number.dads_room_humidity_max_diff
                - src: input_number.dads_room_temp_min_diff_present_summer
                  dest: input_number.dads_room_temp_min_diff
                - src: input_number.dads_room_humidity_min_diff_present_summer
                  dest: input_number.dads_room_humidity_min_diff
                - src: input_number.dads_room_temp_target_present_summer
                  dest: input_number.dads_room_temp_target
                - src: input_number.dads_room_humidity_target_present_summer
                  dest: input_number.dads_room_humidity_target
              sequence:
                - action: input_number.set_value
                  target: 
                    entity_id: "{{ repeat.item.dest }}"
                  data:
                    value: "{{ states(repeat.item.src) }}"
        - conditions:
            - condition: state
              entity_id: input_select.dads_room_climate_mode
              state: "Present Winter"
          sequence:
            repeat:
              for_each:
                - src: input_number.dads_room_temp_max_diff_present_winter
                  dest: input_number.dads_room_temp_max_diff
                - src: input_number.dads_room_humidity_max_diff_present_winter
                  dest: input_number.dads_room_humidity_max_diff
                - src: input_number.dads_room_temp_min_diff_present_winter
                  dest: input_number.dads_room_temp_min_diff
                - src: input_number.dads_room_humidity_min_diff_present_winter
                  dest: input_number.dads_room_humidity_min_diff
                - src: input_number.dads_room_temp_target_present_winter
                  dest: input_number.dads_room_temp_target
                - src: input_number.dads_room_humidity_target_present_winter
                  dest: input_number.dads_room_humidity_target
              sequence:
                - action: input_number.set_value
                  target: 
                    entity_id: "{{ repeat.item.dest }}"
                  data:
                    value: "{{ states(repeat.item.src) }}"
        - conditions:
            - condition: state
              entity_id: input_select.dads_room_climate_mode
              state: "Present Summer Midnight"
          sequence:
            repeat:
              for_each:
                - src: input_number.dads_room_temp_max_diff_present_summer_midnight
                  dest: input_number.dads_room_temp_max_diff
                - src: input_number.dads_room_humidity_max_diff_present_summer_midnight
                  dest: input_number.dads_room_humidity_max_diff
                - src: input_number.dads_room_temp_min_diff_present_summer_midnight
                  dest: input_number.dads_room_temp_min_diff
                - src: input_number.dads_room_humidity_min_diff_present_summer_midnight
                  dest: input_number.dads_room_humidity_min_diff
                - src: input_number.dads_room_temp_target_present_summer_midnight
                  dest: input_number.dads_room_temp_target
                - src: input_number.dads_room_humidity_target_present_summer_midnight
                  dest: input_number.dads_room_humidity_target
              sequence:
                - action: input_number.set_value
                  target: 
                    entity_id: "{{ repeat.item.dest }}"
                  data:
                    value: "{{ states(repeat.item.src) }}"
        - conditions:
            - condition: state
              entity_id: input_select.dads_room_climate_mode
              state: "Present Winter Midnight"
          sequence:
            repeat:
              for_each:
                - src: input_number.dads_room_temp_max_diff_present_winter_midnight
                  dest: input_number.dads_room_temp_max_diff
                - src: input_number.dads_room_humidity_max_diff_present_winter_midnight
                  dest: input_number.dads_room_humidity_max_diff
                - src: input_number.dads_room_temp_min_diff_present_winter_midnight
                  dest: input_number.dads_room_temp_min_diff
                - src: input_number.dads_room_humidity_min_diff_present_winter_midnight
                  dest: input_number.dads_room_humidity_min_diff
                - src: input_number.dads_room_temp_target_present_winter_midnight
                  dest: input_number.dads_room_temp_target
                - src: input_number.dads_room_humidity_target_present_winter_midnight
                  dest: input_number.dads_room_humidity_target
              sequence:
                - action: input_number.set_value
                  target: 
                    entity_id: "{{ repeat.item.dest }}"
                  data:
                    value: "{{ states(repeat.item.src) }}"
        - conditions:
            - condition: state
              entity_id: input_select.dads_room_climate_mode
              state: "Absent Summer"
          sequence:
            repeat:
              for_each:
                - src: input_number.dads_room_temp_max_diff_absent_summer
                  dest: input_number.dads_room_temp_max_diff
                - src: input_number.dads_room_humidity_max_diff_absent_summer
                  dest: input_number.dads_room_humidity_max_diff
                - src: input_number.dads_room_temp_min_diff_absent_summer
                  dest: input_number.dads_room_temp_min_diff
                - src: input_number.dads_room_humidity_min_diff_absent_summer
                  dest: input_number.dads_room_humidity_min_diff
                - src: input_number.dads_room_temp_target_absent_summer
                  dest: input_number.dads_room_temp_target
                - src: input_number.dads_room_humidity_target_absent_summer
                  dest: input_number.dads_room_humidity_target
              sequence:
                - action: input_number.set_value
                  target: 
                    entity_id: "{{ repeat.item.dest }}"
                  data:
                    value: "{{ states(repeat.item.src) }}"
        - conditions:
            - condition: state
              entity_id: input_select.dads_room_climate_mode
              state: "Absent Winter"
          sequence:
            repeat:
              for_each:
                - src: input_number.dads_room_temp_max_diff_absent_winter
                  dest: input_number.dads_room_temp_max_diff
                - src: input_number.dads_room_humidity_max_diff_absent_winter
                  dest: input_number.dads_room_humidity_max_diff
                - src: input_number.dads_room_temp_min_diff_absent_winter
                  dest: input_number.dads_room_temp_min_diff
                - src: input_number.dads_room_humidity_min_diff_absent_winter
                  dest: input_number.dads_room_humidity_min_diff
                - src: input_number.dads_room_temp_target_absent_winter
                  dest: input_number.dads_room_temp_target
                - src: input_number.dads_room_humidity_target_absent_winter
                  dest: input_number.dads_room_humidity_target
              sequence:
                - action: input_number.set_value
                  target: 
                    entity_id: "{{ repeat.item.dest }}"
                  data:
                    value: "{{ states(repeat.item.src) }}"
  trace:
    stored_traces: 100
- id: automation.turn_off_dads_room_ac_cool_2
  alias: "Turn off Dad’s Room AC Cool"
  triggers:
    - trigger: state
      entity_id:
        - input_number.dads_room_temp_target
        - input_number.dads_room_temp_max_diff
        - input_number.dads_room_temp_min_diff
    - trigger: time_pattern
      minutes: "/5"
      seconds: 0
    - trigger: homeassistant
      event: start
  conditions:
    - condition: template
      value_template: >-
        {{
          float(states('sensor.dads_room_temperature')) < 
          float(states('input_number.dads_room_temp_target')) -
          float(states('input_number.dads_room_temp_max_diff'))
        }} 
    - condition: template
      value_template: >-
        {{
          float(states('sensor.dads_room_humidity')) <
          float(states('input_number.dads_room_humidity_target')) +
          float(states('input_number.dads_room_humidity_max_diff'))
        }}
    - condition: state
      entity_id: climate.dads_room_ac
      state: "cool"
  actions:
    - action: climate.turn_off
      target:
        entity_id: climate.dads_room_ac
    - action: notify.tats_devices
      data:
        message: >-
          Turned off Dad’s Room AC Cool.
          Current: {{ states('sensor.dads_room_temperature') }}°C
        data:
          push:
            interruption-level: time-sensitive
          tag: "automation.turn_off_dads_room_ac_cool"
          url: "/lovelace/home"
  trace:
    stored_traces: 100
- id: automation.turn_off_dads_room_ac_dry_2
  alias: "Turn off Dad’s Room AC Dry"
  triggers:
    - trigger: state
      entity_id:
        - input_number.dads_room_humidity_target
        - input_number.dads_room_humidity_max_diff
        - input_number.dads_room_humidity_min_diff
    - trigger: time_pattern
      minutes: "/5"
      seconds: 18
    - trigger: homeassistant
      event: start
  conditions:
    - condition: template
      value_template: >-
        {{
          float(states('sensor.dads_room_humidity')) < 
          float(states('input_number.dads_room_humidity_target')) -
          float(states('input_number.dads_room_humidity_min_diff'))
        }}
    - condition: state
      entity_id: climate.dads_room_ac
      state: "dry"
  actions:
    - action: climate.turn_off
      target:
        entity_id: climate.dads_room_ac
    - action: notify.tats_devices
      data:
        message: >-
          Turned off Dad’s Room AC Dry.
          Current: {{ states('sensor.dads_room_humidity') }}%
        data:
          push:
            interruption-level: time-sensitive
          tag: "automation.turn_off_dads_room_ac_dry"
          url: "/lovelace/home"
  trace:
    stored_traces: 100
- id: automation.turn_on_dads_room_ac_cool_2
  alias: "Turn on Dad’s Room AC Cool"
  triggers:
    - trigger: state
      entity_id:
        - input_number.dads_room_temp_target
        - input_number.dads_room_temp_max_diff
        - input_number.dads_room_temp_min_diff
    - trigger: time_pattern
      minutes: "/5"
      seconds: 31
    - trigger: homeassistant
      event: start
  conditions:
    - condition: template
      value_template: >-
        {{
          float(states('sensor.dads_room_temperature')) > 
          float(states('input_number.dads_room_temp_target')) +
          float(states('input_number.dads_room_temp_max_diff'))
        }}
    - not:
        - condition: state
          entity_id: climate.dads_room_ac
          state: "cool"
  actions:
    - action: climate.set_temperature
      target:
        entity_id: climate.dads_room_ac
      data:
        hvac_mode: "cool"
        temperature: "{{ float(states('input_number.dads_room_temp_target')) }}"
    - action: notify.tats_devices
      data:
        message: >-
          Turned on Dad’s Room AC Cool.
          Current: {{ states('sensor.dads_room_temperature') }}°C
        data:
          push:
            interruption-level: time-sensitive
          tag: "automation.turn_on_dads_room_ac_cool"
          url: "/lovelace/home"
  trace:
    stored_traces: 100
- id: automation.turn_on_dads_room_ac_dry_2
  alias: "Turn on Dad’s Room AC Dry"
  triggers:
    - trigger: state
      entity_id:
        - input_number.dads_room_humidity_target
        - input_number.dads_room_humidity_max_diff
        - input_number.dads_room_humidity_min_diff
    - trigger: time_pattern
      minutes: "/5"
      seconds: 42
    - trigger: homeassistant
      event: start
  conditions:
    - condition: template
      value_template: >-
        {{
          float(states('sensor.dads_room_humidity')) > 
          float(states('input_number.dads_room_humidity_target')) +
          float(states('input_number.dads_room_humidity_max_diff'))
        }}
    - condition: template
      value_template: >-
        {{
          float(states('sensor.dads_room_temperature')) <
          float(states('input_number.dads_room_temp_target')) +
          float(states('input_number.dads_room_temp_max_diff'))
        }}
    - not:
        - condition: state
          entity_id: climate.dads_room_ac
          state: "dry"
  actions:
    - action: climate.set_hvac_mode
      target:
        entity_id: climate.dads_room_ac
      data:
        hvac_mode: "dry"
    - action: notify.tats_devices
      data:
        message: >-
          Turned on Dad’s Room AC Dry.
          Current: {{ states('sensor.dads_room_humidity') }}%
        data:
          push:
            interruption-level: time-sensitive
          tag: "automation.turn_on_dads_room_ac_dry"
          url: "/lovelace/home"
  trace:
    stored_traces: 100
