---
# - name: Set up SSH
#   do_it_yourself_rtx_config:
#     lines:
#       - login user username password
#       - sshd host key generate
#       - sshd service on

- name: Set login
  rtx_config:
    lines:
      - login timer 3600
    save_when:
      changed
  tags: [rtx, rtx-login]

- name: Set security
  rtx_config:
    lines:
      - security class 2 on
    save_when:
      changed
  tags: [rtx, rtx-security]

- name: Set console
  rtx_config:
    lines:
      - console character ascii
      - console prompt [{{ rtx.hostname }}]
    save_when:
      changed
  tags: [rtx, rtx-console]

- name: Set ip
  rtx_config:
    lines:
      - ip route default gateway {{ default_gateway.ip }}
      - ip keepalive 1 icmp-echo 10 5 {{ default_gateway.ip }}
      - ip lan1 address {{ lan1.ip }}/{{ lan1.netmask }}
      - ip lan1 proxyarp on
      - ip lan2 address {{ lan2.ip }}/{{ lan2.netmask }}
    save_when:
      changed
  tags: [rtx, rtx-ip]

- name: Set syslog
  rtx_config:
    lines:
      - syslog host {{ syslogd.ip }}
      - syslog execute command on
    save_when:
      changed
  tags: [rtx, rtx-syslog]

- name: Set dhcp
  rtx_config:
    lines:
      - dhcp client hostname lan1 primary {{ rtx.hostname }}
      - dhcp client hostname lan2 primary {{ rtx.hostname }}
    save_when:
      changed
  tags: [rtx, rtx-dhcp]

- name: Set dns
  rtx_config:
    lines:
      - dns server {{ resolved1.ip }} {{ resolved2.ip }}
      - dns server select 100 {{ resolved1.ip }} {{ resolved2.ip }} any .
    save_when:
      changed
  tags: [rtx, rtx-dns]

- name: Set schedule
  rtx_config:
    lines:
      - schedule at 100 */* 04:52:16 * ntpdate {{ ntpd.fqdn }} syslog
    save_when:
      changed
  tags: [rtx, rtx-schedule]

- name: Get dhcpc
  rtx_command:
    commands:
      - show status dhcpc
  register: result_get_dhcpc
  tags: [rtx, rtx-ip, rtx-dhcp]

- name: Show dhcpc
  debug:
    msg: "{{ result_get_dhcpc.stdout_lines[0] }}"
  tags: [rtx, rtx-ip, rtx-dhcp]
