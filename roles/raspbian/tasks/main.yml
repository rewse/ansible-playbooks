---
- name: Install additional packages
  apt:
    name:
      - awscli
    state: present
  tags: [raspbian, package]

- name: "ssh : Change PubkeyAuthentication"
  lineinfile:
    dest: /etc/ssh/sshd_config
    insertafter: '^#PubkeyAuthentication'
    regexp: '^PubkeyAuthentication'
    line: 'PubkeyAuthentication yes'
  notify: Restart sshd
  tags: [raspbian, ssh]

- name:  "ssh : Change PasswordAuthentication"
  lineinfile:
    dest: /etc/ssh/sshd_config
    insertafter: '^#PasswordAuthentication'
    regexp: '^PasswordAuthentication'
    line: 'PasswordAuthentication no'
  notify: Restart sshd
  tags: [raspbian, ssh]

- name: Copy authorized_keys
  copy:
    src: /home/pi/.ssh/authorized_keys
    dest: /home/{{ admin }}/.ssh/authorized_keys
    remote_src: True
    owner: "{{ admin }}"
    group: "{{ admin }}"
    mode: 0600
  tags: [raspbian, user]