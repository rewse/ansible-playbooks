---
- name: install packages
  yum:
    name: phpMyAdmin
    state: installed
  tags: [phpmyadmin]

- name: set host
  lineinfile:
    dest: /etc/phpMyAdmin/config.inc.php
    regexp: '^\$cfg\[.Servers.\]\[\$i\]\[.host.\] '
    line: "$cfg['Servers'][$i]['host'] = 'mysql.rewse.jp';"
  tags: [phpmyadmin]

- name: set ForceSSL
  lineinfile:
    dest: /etc/phpMyAdmin/config.inc.php
    insertbefore: '^\?>'
    regexp: '^\$cfg\[.ForceSSL.\] '
    line: "$cfg['ForceSSL'] = true;"
  tags: [phpmyadmin]

- name: set Require
  replace:
    dest: /etc/httpd/conf.d/phpMyAdmin.conf
    regexp: 'Require ip 127.0.0.1'
    replace: 'Require ip {{global_ip.home}} {{global_ip.office}}'
  notify: reload httpd
  tags: [phpmyadmin]
