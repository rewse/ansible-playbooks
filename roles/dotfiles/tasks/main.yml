---
- name: clone dotfiles.git
  git:
    repo: git@github.com:rewse/dotfiles.git
    dest: /srv/git/dotfiles
    accept_hostkey: yes
    key_file: /home/{{admin}}/.ssh/id_rsa
  tags: [dotfiles]

- name: change mode of git/dotfiles
  file:
    path: /srv/git/dotfiles
    owner: "{{admin}}"
    group: "{{admin}}"
    recurse: yes
  tags: [dotfiles, bash, git, tmux, vim]

- name: copy bash_profile
  copy:
    src: /srv/git/dotfiles/bash_profile
    dest: /etc/profile.d/bash_profile.sh
    remote_src: True
  tags: [dotfiles, bash]

- name: copy bashrc
  copy:
    src: /srv/git/dotfiles/bashrc
    dest: /etc/profile.d/bashrc.sh
    remote_src: True
  tags: [dotfiles, bash]

- name: copy gitconfig
  become_user: "{{admin}}"
  copy:
    src: /srv/git/dotfiles/gitconfig
    dest: /home/{{admin}}/.gitconfig
    remote_src: True
  tags: [dotfiles, git]

- name: git; set user email
  become_user: "{{admin}}"
  ini_file:
    dest: /home/{{admin}}/.gitconfig
    section: user
    option: email
    value: "{{email.primary}}"
  tags: [dotfiles, git]

- name: tmux; copy tmux.conf
  copy:
    src: /srv/git/dotfiles/tmux.conf
    dest: /etc/tmux.conf
    remote_src: True
  tags: [dotfiles, tmux]

- name: vim; copy vimfiles
  copy:
    src: /srv/git/dotfiles/vim/vimrc
    dest: /etc/vim/vimrc.local
    remote_src: True
  when: 'ansible_os_family == "Debian"'
  tags: [dotfiles, vim]

- name: vim; copy vimfiles
  copy:
    src: /srv/git/dotfiles/vim/vimrc
    dest: /usr/share/vim/vimfiles/vimrc
    remote_src: True
  when: 'ansible_os_family == "RedHat"'
  tags: [dotfiles, vim]

- name: vim; add to import vimrc
  lineinfile:
    dest: /etc/vimrc
    line: 'source /usr/share/vim/vimfiles/vimrc'
  when: 'ansible_os_family == "RedHat"'
  tags: [dotfiles, vim]