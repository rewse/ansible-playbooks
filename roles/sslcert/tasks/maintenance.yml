---
- name: "certbot : Update all dependencies with eager strategy"
  ansible.builtin.shell: uv pip install --upgrade --upgrade-strategy eager certbot certbot-apache certbot-dns-route53
  environment:
    VIRTUAL_ENV: /opt/certbot
  tags:
    - sslcert
    - maintenance
    - sslcert_maintenance
    - never

- name: "certbot : List installed packages after update"
  ansible.builtin.shell: uv pip list
  environment:
    VIRTUAL_ENV: /opt/certbot
  register: certbot_packages
  tags:
    - sslcert
    - maintenance
    - sslcert_maintenance
    - never

- name: "certbot : Display installed packages"
  ansible.builtin.debug:
    var: certbot_packages.stdout_lines
  tags:
    - sslcert
    - maintenance
    - sslcert_maintenance
    - never

- name: "certbot : Test certificate renewal (dry run)"
  ansible.builtin.shell: certbot renew --dry-run
  environment:
    VIRTUAL_ENV: /opt/certbot
  tags:
    - sslcert
    - maintenance
    - sslcert_maintenance
    - never
