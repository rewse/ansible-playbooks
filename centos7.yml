---
- hosts: centos
  become: yes
  remote_user: centos
  vars:
    swap_device: xvdb
  tasks:
    - name: check swap status
      command: cat /proc/swaps
      register: swaps_out
      changed_when: False
      tags: [storage, swap]

    - name: make swap
      command: mkswap /dev/{{swap_device}}
      args:
        removes: /dev/{{swap_device}}
      when: swaps_out.stdout.find('{{swap_device}}') == -1
      tags: [storage, swap]

    - name: enable swap
      command: swapon /dev/{{swap_device}}
      args:
        removes: /dev/{{swap_device}}
      when: swaps_out.stdout.find('{{swap_device}}') == -1
      tags: [storage, swap]
